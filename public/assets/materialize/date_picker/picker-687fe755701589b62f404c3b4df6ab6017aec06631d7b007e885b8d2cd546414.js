!function(e){"function"==typeof define&&define.amd?define("picker",["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):this.Picker=e(jQuery)}(function(e){function t(o,r,l,d){function p(){return t._.node("div",t._.node("div",t._.node("div",t._.node("div",A.component.nodes(k.open),w.box),w.wrap),w.frame),w.holder)}function h(){S.data(r,A).addClass(w.input).attr("tabindex",-1).val(S.data("value")?A.get("select",y.format):o.value),y.editable||S.on("focus."+k.id+" click."+k.id,function(e){e.preventDefault(),A.$root.eq(0).focus()}).on("keydown."+k.id,f),n(o,{haspopup:!0,expanded:!1,readonly:!1,owns:o.id+"_root"})}function m(){A.$root.on({keydown:f,focusin:function(e){A.$root.removeClass(w.focused),e.stopPropagation()},"mousedown click":function(t){var i=t.target;i!=A.$root.children()[0]&&(t.stopPropagation(),"mousedown"!=t.type||e(i).is("input, select, textarea, button, option")||(t.preventDefault(),A.$root.eq(0).focus()))}}).on({focus:function(){S.addClass(w.target)},blur:function(){S.removeClass(w.target)}}).on("focus.toOpen",b).on("click","[data-pick], [data-nav], [data-clear], [data-close]",function(){var t=e(this),i=t.data(),a=t.hasClass(w.navDisabled)||t.hasClass(w.disabled),n=s();n=n&&(n.type||n.href),(a||n&&!e.contains(A.$root[0],n))&&A.$root.eq(0).focus(),!a&&i.nav?A.set("highlight",A.component.item.highlight,{nav:i.nav}):!a&&"pick"in i?A.set("select",i.pick):i.clear?A.clear().close(!0):i.close&&A.close(!0)}),n(A.$root[0],"hidden",!0)}function g(){var t;y.hiddenName===!0?(t=o.name,o.name=""):(t=["string"==typeof y.hiddenPrefix?y.hiddenPrefix:"","string"==typeof y.hiddenSuffix?y.hiddenSuffix:"_submit"],t=t[0]+o.name+t[1]),A._hidden=e('<input type=hidden name="'+t+'"'+(S.data("value")||o.value?' value="'+A.get("select",y.formatSubmit)+'"':"")+">")[0],S.on("change."+k.id,function(){A._hidden.value=o.value?A.get("select",y.formatSubmit):""}),y.container?e(y.container).append(A._hidden):S.after(A._hidden)}function f(e){var t=e.keyCode,i=/^(8|46)$/.test(t);return 27==t?(A.close(),!1):void((32==t||i||!k.open&&A.component.key[t])&&(e.preventDefault(),e.stopPropagation(),i?A.clear().close():A.open()))}function b(e){e.stopPropagation(),"focus"==e.type&&A.$root.addClass(w.focused),A.open()}if(!o)return t;var v=!1,k={id:o.id||"P"+Math.abs(~~(Math.random()*new Date))},y=l?e.extend(!0,{},l.defaults,d):d||{},w=e.extend({},t.klasses(),y.klass),S=e(o),T=function(){return this.start()},A=T.prototype={constructor:T,$node:S,start:function(){return k&&k.start?A:(k.methods={},k.start=!0,k.open=!1,k.type=o.type,o.autofocus=o==s(),o.readOnly=!y.editable,o.id=o.id||k.id,"text"!=o.type&&(o.type="text"),A.component=new l(A,y),A.$root=e(t._.node("div",p(),w.picker,'id="'+o.id+'_root" tabindex="0"')),m(),y.formatSubmit&&g(),h(),y.container?e(y.container).append(A.$root):S.after(A.$root),A.on({start:A.component.onStart,render:A.component.onRender,stop:A.component.onStop,open:A.component.onOpen,close:A.component.onClose,set:A.component.onSet}).on({start:y.onStart,render:y.onRender,stop:y.onStop,open:y.onOpen,close:y.onClose,set:y.onSet}),v=i(A.$root.children()[0]),o.autofocus&&A.open(),A.trigger("start").trigger("render"))},render:function(e){return e?A.$root.html(p()):A.$root.find("."+w.box).html(A.component.nodes(k.open)),A.trigger("render")},stop:function(){return k.start?(A.close(),A._hidden&&A._hidden.parentNode.removeChild(A._hidden),A.$root.remove(),S.removeClass(w.input).removeData(r),setTimeout(function(){S.off("."+k.id)},0),o.type=k.type,o.readOnly=!1,A.trigger("stop"),k.methods={},k.start=!1,A):A},open:function(i){return k.open?A:(S.addClass(w.active),n(o,"expanded",!0),setTimeout(function(){A.$root.addClass(w.opened),n(A.$root[0],"hidden",!1)},0),i!==!1&&(k.open=!0,v&&c.css("overflow","hidden").css("padding-right","+="+a()),A.$root.eq(0).focus(),u.on("click."+k.id+" focusin."+k.id,function(e){var t=e.target;t!=o&&t!=document&&3!=e.which&&A.close(t===A.$root.children()[0])}).on("keydown."+k.id,function(i){var a=i.keyCode,n=A.component.key[a],o=i.target;27==a?A.close(!0):o!=A.$root[0]||!n&&13!=a?e.contains(A.$root[0],o)&&13==a&&(i.preventDefault(),o.click()):(i.preventDefault(),n?t._.trigger(A.component.key.go,A,[t._.trigger(n)]):A.$root.find("."+w.highlighted).hasClass(w.disabled)||A.set("select",A.component.item.highlight).close())})),A.trigger("open"))},close:function(e){return e&&(A.$root.off("focus.toOpen").eq(0).focus(),setTimeout(function(){A.$root.on("focus.toOpen",b)},0)),S.removeClass(w.active),n(o,"expanded",!1),setTimeout(function(){A.$root.removeClass(w.opened+" "+w.focused),n(A.$root[0],"hidden",!0)},0),k.open?(k.open=!1,v&&c.css("overflow","").css("padding-right","-="+a()),u.off("."+k.id),A.trigger("close")):A},clear:function(e){return A.set("clear",null,e)},set:function(t,i,a){var n,o,r=e.isPlainObject(t),s=r?t:{};if(a=r&&e.isPlainObject(i)?i:a||{},t){r||(s[t]=i);for(n in s)o=s[n],n in A.component.item&&(void 0===o&&(o=null),A.component.set(n,o,a)),"select"!=n&&"clear"!=n||S.val("clear"==n?"":A.get(n,y.format)).trigger("change");A.render()}return a.muted?A:A.trigger("set",s)},get:function(e,i){if(e=e||"value",null!=k[e])return k[e];if("valueSubmit"==e){if(A._hidden)return A._hidden.value;e="value"}if("value"==e)return o.value;if(e in A.component.item){if("string"==typeof i){var a=A.component.get(e);return a?t._.trigger(A.component.formats.toString,A.component,[i,a]):""}return A.component.get(e)}},on:function(t,i,a){var n,o,r=e.isPlainObject(t),s=r?t:{};if(t){r||(s[t]=i);for(n in s)o=s[n],a&&(n="_"+n),k.methods[n]=k.methods[n]||[],k.methods[n].push(o)}return A},off:function(){var e,t,i=arguments;for(e=0,namesCount=i.length;e<namesCount;e+=1)t=i[e],t in k.methods&&delete k.methods[t];return A},trigger:function(e,i){var a=function(e){var a=k.methods[e];a&&a.map(function(e){t._.trigger(e,A,[i])})};return a("_"+e),a(e),A}};return new T}function i(e){var t,i="position";return e.currentStyle?t=e.currentStyle[i]:window.getComputedStyle&&(t=getComputedStyle(e)[i]),"fixed"==t}function a(){if(c.height()<=l.height())return 0;var t=e('<div style="visibility:hidden;width:100px" />').appendTo("body"),i=t[0].offsetWidth;t.css("overflow","scroll");var a=e('<div style="width:100%" />').appendTo(t),n=a[0].offsetWidth;return t.remove(),i-n}function n(t,i,a){if(e.isPlainObject(i))for(var n in i)o(t,n,i[n]);else o(t,i,a)}function o(e,t,i){e.setAttribute(("role"==t?"":"aria-")+t,i)}function r(t,i){e.isPlainObject(t)||(t={attribute:i}),i="";for(var a in t){var n=("role"==a?"":"aria-")+a,o=t[a];i+=null==o?"":n+'="'+t[a]+'"'}return i}function s(){try{return document.activeElement}catch(e){}}var l=e(window),u=e(document),c=e(document.documentElement);return t.klasses=function(e){return e=e||"picker",{picker:e,opened:e+"--opened",focused:e+"--focused",input:e+"__input",active:e+"__input--active",target:e+"__input--target",holder:e+"__holder",frame:e+"__frame",wrap:e+"__wrap",box:e+"__box"}},t._={group:function(e){for(var i,a="",n=t._.trigger(e.min,e);n<=t._.trigger(e.max,e,[n]);n+=e.i)i=t._.trigger(e.item,e,[n]),a+=t._.node(e.node,i[0],i[1],i[2]);return a},node:function(t,i,a,n){return i?(i=e.isArray(i)?i.join(""):i,a=a?' class="'+a+'"':"",n=n?" "+n:"","<"+t+a+n+">"+i+"</"+t+">"):""},lead:function(e){return(e<10?"0":"")+e},trigger:function(e,t,i){return"function"==typeof e?e.apply(t,i||[]):e},digits:function(e){return/\d/.test(e[1])?2:1},isDate:function(e){return{}.toString.call(e).indexOf("Date")>-1&&this.isInteger(e.getDate())},isInteger:function(e){return{}.toString.call(e).indexOf("Number")>-1&&e%1===0},ariaAttr:r},t.extend=function(i,a){e.fn[i]=function(n,o){var r=this.data(i);return"picker"==n?r:r&&"string"==typeof n?t._.trigger(r[n],r,[o]):this.each(function(){var o=e(this);o.data(i)||new t(this,i,a,n)})},e.fn[i].defaults=a.defaults},t});